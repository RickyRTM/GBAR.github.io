<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#2ba9d9" />
  <link rel="manifest" href="/GBAR.github.io/manifest.json" />
  <link rel="stylesheet" href="/GBAR.github.io/styles.css" />
  <link rel="icon" href="/icons/icon-192.png" type="image/png" />
  <title>GBAR</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    #status-container {
      display: flex;
      gap: 10px;
      align-items: center;
      padding: 10px;
      background: #e0f7fa;
      position: fixed;
      top: 60px;
      right: 20px;
      border-radius: 8px;
      z-index: 1000;
    }
    #status-container button {
      cursor: pointer;
      padding: 6px 12px;
      border: none;
      background-color: #0288d1;
      color: white;
      border-radius: 4px;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }
    #status-container button:hover, #status-container button:focus {
      background-color: #026aa7;
      outline: none;
    }
    #connection-status {
      display: flex;
      align-items: center;
      font-weight: 600;
      color: #027a18;
    }
    #connection-status.offline {
      color: #d32f2f;
    }
    #connection-status .dot {
      height: 12px;
      width: 12px;
      border-radius: 50%;
      background-color: currentColor;
      display: inline-block;
      margin-right: 6px;
      box-shadow: 0 0 6px currentColor;
    }

    .comments-container {
      margin-top: 1rem;
      max-width: 600px;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .comment {
      background: #f0f9ff;
      border-radius: 8px;
      padding: 10px 15px;
      display: flex;
      gap: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      position: relative;
    }
    .avatar {
      background-color: #0288d1;
      color: white;
      font-weight: bold;
      font-size: 1.5rem;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      flex-shrink: 0;
      box-shadow: 0 0 8px #0288d1;
    }
    .comment-content {
      flex: 1;
    }
    .comment-content strong {
      font-size: 1.1rem;
    }
    .comment-content p {
      margin: 0.3rem 0 0.6rem 0;
      white-space: pre-wrap;
    }
    .comment-content .date {
      font-size: 0.75rem;
      color: #555;
    }
    .delete-comment-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: transparent;
      border: none;
      color: #d32f2f;
      font-size: 1.2rem;
      cursor: pointer;
      user-select: none;
      transition: color 0.3s ease;
    }
    .delete-comment-btn:hover,
    .delete-comment-btn:focus {
      color: #9b0000;
      outline: none;
    }

    form#commentForm {
      margin-top: 1rem;
      max-width: 600px;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    form#commentForm input,
    form#commentForm textarea {
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #0288d1;
      font-size: 1rem;
      resize: vertical;
      transition: border-color 0.3s ease;
    }
    form#commentForm input:focus,
    form#commentForm textarea:focus {
      outline: none;
      border-color: #015a8f;
      box-shadow: 0 0 6px #0288d1;
    }
    form#commentForm button {
      background-color: #0288d1;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      padding: 10px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.3s ease;
      align-self: flex-start;
    }
    form#commentForm button:hover,
    form#commentForm button:focus {
      background-color: #015a8f;
      outline: none;
    }
  </style>
</head>
<body>
  <header>
    <nav class="top-nav" role="navigation" aria-label="Men√∫ principal">
      <div class="logo" aria-label="Logo GBAR">üåä GBAR</div>
      <input type="checkbox" id="menu-toggle" />
      <label for="menu-toggle" class="menu-icon" aria-label="Mostrar men√∫">‚ò∞</label>
      <ul class="menu" role="menubar">
        <li role="none"><a href="#home" role="menuitem" data-key="nav-home">Inicio</a></li>
        <li role="none"><a href="#about" role="menuitem" data-key="nav-about">Acerca</a></li>
        <li role="none"><a href="#comments-section" role="menuitem" data-key="nav-comments">Comentarios</a></li>
        <li role="none"><a href="#app" role="menuitem" data-key="nav-app">App</a></li>
        <li role="none"><a href="#faq" role="menuitem" data-key="nav-faq">Preguntas</a></li>
      </ul>
    </nav>
  </header>

  <div id="status-container" role="region" aria-label="Estado de conexi√≥n y controles">
    <div id="connection-status" aria-live="polite" aria-atomic="true" class="online" tabindex="0">
      <span class="dot"></span>
      <span data-key="status-online-text">Conectado</span>
    </div>
    <button id="dark-mode-toggle" aria-pressed="false" aria-label="Activar modo oscuro">Modo Oscuro</button>
    <button id="lang-toggle" aria-pressed="false" aria-label="Cambiar idioma">ES/EN</button>
  </div>

  <main>
    <section id="home" tabindex="-1">
      <h1 data-key="home-welcome">Bienvenido a GBAR</h1>
      <p data-key="home-subtitle">Explora y protege los ecosistemas submarinos con nosotros.</p>
    </section>

    <section id="about" tabindex="-1">
      <h2 data-key="about-title">üåä Acerca de nuestra misi√≥n</h2>
      <p data-key="about-hours">150+ horas puestas en el proyecto.</p>
      <p data-key="about-text-1">
        Este proyecto es el resultado de trabajo colaborativo, creatividad y pasi√≥n.
        Buscamos crear conciencia sobre la vida marina y c√≥mo protegerla.
      </p>
    </section>

    <section id="comments-section" tabindex="-1">
      <h2 data-key="comments-title">üí¨ Comentarios</h2>
      <div id="commentsList" class="comments-container" aria-live="polite" aria-relevant="additions"></div>
      <form id="commentForm" aria-label="Formulario para agregar comentario">
        <input
          type="text"
          id="username"
          placeholder="Tu nombre"
          required
          aria-required="true"
          aria-describedby="usernameHelp"
          autocomplete="name"
        />
        <small id="usernameHelp" class="sr-only">Ingresa tu nombre para comentar.</small>
        <textarea
          id="comment"
          placeholder="Escribe tu comentario..."
          rows="3"
          required
          aria-required="true"
          aria-describedby="commentHelp"
        ></textarea>
        <small id="commentHelp" class="sr-only">Escribe tu opini√≥n o pregunta.</small>
        <button type="submit" data-key="comments-submit">Enviar Comentario</button>
        <div id="form-feedback" role="alert" aria-live="assertive" style="color: #027a18; font-weight: 700; margin-top: 0.5rem;"></div>
      </form>
    </section>

    <section id="app" tabindex="-1">
      <h2 data-key="app-title">üì± Descarga la App</h2>
      <p data-key="app-text">Instala GBAR para una experiencia completa en tu dispositivo m√≥vil.</p>
      <button onclick="installApp()" data-key="app-install-btn">Instalar App</button>
    </section>

    <section id="faq" tabindex="-1" aria-label="Preguntas frecuentes">
      <h2 data-key="faq-title">‚ùì Preguntas Frecuentes</h2>
      <div class="faq-container">
        <div class="faq-item">
          <button class="faq-question" aria-expanded="false" aria-controls="faq1" id="faq1-btn">
            ¬øQui√©nes somos? <span class="faq-icon">+</span>
          </button>
          <div id="faq1" class="faq-answer" role="region" aria-labelledby="faq1-btn" hidden>
            <p>Somos cuatro estudiantes de Desarrollo de Software apasionados por la tecnolog√≠a, los videojuegos y el medio ambiente. Este proyecto representa nuestro trabajo final de carrera, donde elegimos integrar uno de los 17 Objetivos de Desarrollo Sostenible propuestos por la ONU: el punto 14 ‚Äì Vida Submarina. Lo que comenz√≥ como una idea t√©cnica, se transform√≥ en una causa. Hoy queremos que nuestra plataforma no solo entretenga, sino que tambi√©n eduque y despierte conciencia.</p>
          </div>
        </div>
        <div class="faq-item">
          <button class="faq-question" aria-expanded="false" aria-controls="faq2" id="faq2-btn">
            ¬øPor qu√© lo hicimos? <span class="faq-icon">+</span>
          </button>
          <div id="faq2" class="faq-answer" role="region" aria-labelledby="faq2-btn" hidden>
            <p>Porque sabemos que muchas personas, especialmente quienes viven lejos de las costas o nunca han visto el mar, no dimensionan lo importante que es. El oc√©ano regula el clima, produce ox√≠geno, es hogar de millones de especies‚Ä¶ y est√° muriendo en silencio. Hicimos este juego para conectar emocionalmente a las personas con la vida marina, sin importar d√≥nde vivan. Creemos que si puedes explorar el fondo marino desde tu pantalla, tal vez te importe m√°s protegerlo desde la realidad.</p>
          </div>
        </div>
        <div class="faq-item">
          <button class="faq-question" aria-expanded="false" aria-controls="faq3" id="faq3-btn">
            ¬øCu√°l es nuestra misi√≥n? <span class="faq-icon">+</span>
          </button>
          <div id="faq3" class="faq-answer" role="region" aria-labelledby="faq3-btn" hidden>
            <p>Nuestra misi√≥n es clara: generar un cambio de conciencia a trav√©s de la tecnolog√≠a y el entretenimiento. Queremos que nuestros jugadores aprendan, se conmuevan y act√∫en. No basta con saber que el oc√©ano est√° en peligro; queremos que quienes jueguen se pregunten qu√© pueden hacer para salvarlo. Nuestro videojuego es solo una chispa, pero puede encender una conciencia que dure toda la vida.</p>
          </div>
        </div>
        <div class="faq-item">
          <button class="faq-question" aria-expanded="false" aria-controls="faq4" id="faq4-btn">
            ¬øC√≥mo nos mantenemos a flote? <span class="faq-icon">+</span>
          </button>
          <div id="faq4" class="faq-answer" role="region" aria-labelledby="faq4-btn" hidden>
            <p>Nos mantenemos a flote gracias a nuestra pasi√≥n por crear, aprender y proteger el planeta. Este proyecto fue completamente desarrollado por nosotros, usando herramientas libres y c√≥digo abierto. No recibimos financiamiento externo, pero nos mueve algo m√°s fuerte: la convicci√≥n de que la tecnolog√≠a puede ser usada para el bien. Cada l√≠nea de c√≥digo, cada sprite, cada idea surgi√≥ de una motivaci√≥n genuina por marcar la diferencia.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <p>¬© 2025 GBAR. Todos los derechos reservados.</p>
  </footer>

  <script>

    const firebaseConfig = {
      apiKey: "AIzaSyBHB_6aIb_MWTojKx0asdkdRSfhGO4Blys",
      authDomain: "gbar-61a43.firebaseapp.com",
      databaseURL: "https://gbar-61a43-default-rtdb.firebaseio.com",
      projectId: "gbar-61a43",
      storageBucket: "gbar-61a43.appspot.com",
      messagingSenderId: "929964316297",
      appId: "1:929964316297:web:53ef1aa347df095d86d858"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const commentForm = document.getElementById("commentForm");
    const commentList = document.getElementById("commentsList");
    const feedbackEl = document.getElementById("form-feedback");
    const darkModeToggle = document.getElementById("dark-mode-toggle");
    const langToggle = document.getElementById("lang-toggle");
    const connectionStatus = document.getElementById("connection-status");

    commentForm.addEventListener("submit", e => {
      e.preventDefault();
      feedbackEl.textContent = "";

      const username = document.getElementById("username").value.trim();
      const text = document.getElementById("comment").value.trim();

      if (!username) {
        feedbackEl.style.color = "#d32f2f";
        feedbackEl.textContent = currentLang === "es" ? "Por favor ingresa tu nombre." : "Please enter your name.";
        return;
      }
      if (!text) {
        feedbackEl.style.color = "#d32f2f";
        feedbackEl.textContent = currentLang === "es" ? "Por favor escribe un comentario." : "Please write a comment.";
        return;
      }

      const comment = {
        UserName: username,
        Text: text,
        Date: new Date().toISOString()
      };

      db.ref("Comments").push(comment).then(() => {
        commentForm.reset();
        feedbackEl.style.color = "#027a18";
        feedbackEl.textContent = currentLang === "es" ? "Comentario enviado. ¬°Gracias!" : "Comment sent. Thanks!";
        setTimeout(() => {
          feedbackEl.textContent = "";
          feedbackEl.style.color = "#000";
        }, 4000);
      }).catch(() => {
        feedbackEl.style.color = "#d9534f";
        feedbackEl.textContent = currentLang === "es" ? "Error al enviar el comentario." : "Error sending comment.";
      });
    });

    function loadComments() {
      db.ref("Comments").on("value", snapshot => {
        commentList.innerHTML = "";
        const comments = snapshot.val();
        if (comments) {
          const sorted = Object.entries(comments).sort((a,b) => new Date(b[1].Date) - new Date(a[1].Date));
          sorted.forEach(([key, c]) => {
            const div = document.createElement("div");
            div.classList.add("comment");

            const avatar = document.createElement("div");
            avatar.className = "avatar";
            avatar.textContent = c.UserName.charAt(0).toUpperCase();

            const content = document.createElement("div");
            content.className = "comment-content";
            content.innerHTML = `
              <strong>${c.UserName}</strong>
              <p>${escapeHtml(c.Text)}</p>
              <small class="date">${new Date(c.Date).toLocaleString()}</small>
            `;

            div.appendChild(avatar);
            div.appendChild(content);

            const currentName = document.getElementById("username").value.trim();
            if(currentName && currentName.toLowerCase() === c.UserName.toLowerCase()) {
              const deleteBtn = document.createElement("button");
              deleteBtn.className = "delete-comment-btn";
              deleteBtn.setAttribute("aria-label", currentLang === "es" ? "Eliminar comentario" : "Delete comment");
              deleteBtn.innerHTML = "√ó";
              deleteBtn.addEventListener("click", () => {
                if(confirm(currentLang === "es" ? "¬øEliminar este comentario?" : "Delete this comment?")) {
                  db.ref(`Comments/${key}`).remove();
                }
              });
              div.appendChild(deleteBtn);
            }

            commentList.appendChild(div);
          });
        } else {
          commentList.innerHTML = `<p>${currentLang === "es" ? "No hay comentarios todav√≠a." : "No comments yet."}</p>`;
        }
      });
    }

    function escapeHtml(text) {
      return text.replace(/[&<>"']/g, m => ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      })[m]);
    }

    darkModeToggle.addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");
      const active = document.body.classList.contains("dark-mode");
      darkModeToggle.setAttribute("aria-pressed", active.toString());
      darkModeToggle.textContent = active ? (currentLang === "es" ? "Modo Claro" : "Light Mode") : (currentLang === "es" ? "Modo Oscuro" : "Dark Mode");
    });

    let currentLang = "es";
    langToggle.addEventListener("click", () => {
      currentLang = currentLang === "es" ? "en" : "es";
      langToggle.setAttribute("aria-pressed", (currentLang === "en").toString());
      updateTexts();
    });

    function updateTexts() {
      
      document.querySelectorAll("[data-key]").forEach(el => {
        const key = el.getAttribute("data-key");
        if (translations[currentLang][key]) {
          el.textContent = translations[currentLang][key];
        }
      });

      const darkOn = document.body.classList.contains("dark-mode");
      darkModeToggle.textContent = darkOn ? (currentLang === "es" ? "Modo Claro" : "Light Mode") : (currentLang === "es" ? "Modo Oscuro" : "Dark Mode");
      langToggle.textContent = currentLang.toUpperCase();

      const statusTextSpan = connectionStatus.querySelector("[data-key='status-online-text']");
      if (navigator.onLine) {
        connectionStatus.classList.remove("offline");
        statusTextSpan.textContent = currentLang === "es" ? "Conectado" : "Online";
      } else {
        connectionStatus.classList.add("offline");
        statusTextSpan.textContent = currentLang === "es" ? "Desconectado" : "Offline";
      }
    }

    const translations = {
      es: {
        "nav-home": "Inicio",
        "nav-about": "Acerca",
        "nav-comments": "Comentarios",
        "nav-app": "App",
        "nav-faq": "Preguntas",
        "status-online-text": "Conectado",
        "home-welcome": "Bienvenido a GBAR",
        "home-subtitle": "Explora y protege los ecosistemas submarinos con nosotros.",
        "about-title": "üåä Acerca de nuestra misi√≥n",
        "about-hours": "150+ horas puestas en el proyecto.",
        "about-text-1": "Este proyecto es el resultado de trabajo colaborativo, creatividad y pasi√≥n.\nBuscamos crear conciencia sobre la vida marina y c√≥mo protegerla.",
        "comments-title": "üí¨ Comentarios",
        "comments-submit": "Enviar Comentario",
        "app-title": "üì± Descarga la App",
        "app-text": "Instala GBAR para una experiencia completa en tu dispositivo m√≥vil.",
        "app-install-btn": "Instalar App",
        "faq-title": "‚ùì Preguntas Frecuentes"
      },
      en: {
        "nav-home": "Home",
        "nav-about": "About",
        "nav-comments": "Comments",
        "nav-app": "App",
        "nav-faq": "FAQ",
        "status-online-text": "Online",
        "home-welcome": "Welcome to GBAR",
        "home-subtitle": "Explore and protect marine ecosystems with us.",
        "about-title": "üåä About Our Mission",
        "about-hours": "150+ hours dedicated to this project.",
        "about-text-1": "This project is the result of collaborative work, creativity, and passion.\nWe aim to raise awareness about marine life and how to protect it.",
        "comments-title": "üí¨ Comments",
        "comments-submit": "Send Comment",
        "app-title": "üì± Download the App",
        "app-text": "Install GBAR for a full experience on your mobile device.",
        "app-install-btn": "Install App",
        "faq-title": "‚ùì Frequently Asked Questions"
      }
    };

    function updateConnectionStatus() {
      if (navigator.onLine) {
        connectionStatus.classList.remove("offline");
        connectionStatus.querySelector("[data-key='status-online-text']").textContent = currentLang === "es" ? "Conectado" : "Online";
      } else {
        connectionStatus.classList.add("offline");
        connectionStatus.querySelector("[data-key='status-online-text']").textContent = currentLang === "es" ? "Desconectado" : "Offline";
      }
    }
    window.addEventListener("online", updateConnectionStatus);
    window.addEventListener("offline", updateConnectionStatus);

    document.querySelectorAll(".faq-question").forEach(button => {
      button.addEventListener("click", () => {
        const expanded = button.getAttribute("aria-expanded") === "true";
        button.setAttribute("aria-expanded", !expanded);
        const answer = document.getElementById(button.getAttribute("aria-controls"));
        if (answer) {
          if (expanded) {
            answer.hidden = true;
            button.querySelector(".faq-icon").textContent = "+";
          } else {
            answer.hidden = false;
            button.querySelector(".faq-icon").textContent = "‚àí";
          }
        }
      });
    });

    function escapeHtml(text) {
      return text.replace(/[&<>"']/g, function(m) {
        return {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;'
        }[m];
      });
    }

    loadComments();
    updateConnectionStatus();
    updateTexts();

    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
    });
    function installApp() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(choiceResult => {
          deferredPrompt = null;
        });
      }
    }
  </script>
</body>
</html>
